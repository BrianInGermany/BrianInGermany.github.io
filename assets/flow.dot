digraph tel_flow {
    node[style=filled]
    start[shape=circle,color=black]
    end[shape=doublecircle,color=black]
    prompt_welcome[shape=box,color=lightblue,label="Willkommen
        beim Telefonkontakt der ABC-
        Krankenkasse! Ein Kundenagent 
        ist gleich für Sie da."]
    prompt_vnr[shape=box,color=lightblue,label="Bevor ich Sie verbinde,
        sagen Sie mir bitte Ihre
        Versichertennummer. Sie beginnt 
        mit einem Buchstaben, gefolgt
        von 8 Ziffern"]
    utterance_vnr[shape=box,color=yellowgreen,label="VNR-Utterance"]
    nlu_vnr[shape=invhouse,label="NLU: Versichertennr.?"]
    nlu_anliegen[shape=invhouse,label="NLU: Anliegen?"]
    prompt_vnr_fail[shape=box,color=lightblue,label="Das hat leider nicht geklappt. 
        Probieren wirs nochmal.
        Sagen Sie mir bitte Ihre
        Versichertennummer."]
    prompt_vnr_success[shape=box,color=lightblue,label="Danke! Mit welchem Thema 
        können wir Sie heute unterstützen?"]
    utterance_anliegen[shape=box,color=yellowgreen,label="Anliegen-Utterance"]
    prompt_anliegen_success[shape=box,color=lightblue,label="Zu Thema XX
        unterstützt Sie gleich ein Kundenagent.
        Ich verbinde Sie."]
    intent_vnr_no_intent[shape=house,label="VNR_NO_INTENT"]
    intent_vnr_agent[shape=house,label="VNR_AGENT"]
    intent_vnr_vnr[shape=house,label="VNR_VNR"]
    intent_anliegen_no_intent[shape=house,label="ANLIEGEN_NO_INTENT"]
    intent_anliegen_agent[shape=house,label="ANLIEGEN_AGENT"]
    intent_anliegen_xx[shape=house,label="ANLIEGEN_XX"]
    prompt_connect_agent[shape=box,color=lightblue,label="Ich verbinde Sie mit
        einem Kundenagenten."]
    logic_zweitversuch_vnr[shape=diamond,label="Zweitversuch V-Nr?"]
    prompt_nicht_verstanden_anliegen[shape=box,color=lightblue,label="Ich konnte Sie leider
        nicht verstehen. Um welchen 
        Themenkomplex geht es?"]
    logic_zweitversuch_anliegen[shape=diamond,label="Zweitversuch Anliegen?"]


subgraph cluster_welcome {
    label = "Willkommen"
    color = blue
    start -> prompt_welcome

}

subgraph cluster_vnr {
    label = "Versichertennummer verstehen"
    color = blue
    prompt_welcome -> prompt_vnr

    prompt_vnr -> utterance_vnr
    utterance_vnr -> nlu_vnr
    nlu_vnr -> intent_vnr_agent
    nlu_vnr -> intent_vnr_vnr
    nlu_vnr -> intent_vnr_no_intent
    intent_vnr_no_intent -> logic_zweitversuch_vnr
    logic_zweitversuch_vnr -> prompt_vnr_fail [label="nein"]
}
    logic_zweitversuch_vnr -> prompt_connect_agent [label="ja"]
    prompt_connect_agent -> end
    prompt_vnr_fail -> utterance_vnr
    prompt_vnr_success -> utterance_anliegen
    utterance_anliegen -> nlu_anliegen

subgraph cluster_anliegen {
    label = "Anliegen verstehen"
    color = blue
    intent_vnr_vnr -> prompt_vnr_success

    nlu_anliegen -> intent_anliegen_xx
    nlu_anliegen -> intent_anliegen_agent
    nlu_anliegen -> intent_anliegen_no_intent
    intent_anliegen_no_intent -> logic_zweitversuch_anliegen
    logic_zweitversuch_anliegen -> prompt_nicht_verstanden_anliegen [label="nein"]
    prompt_nicht_verstanden_anliegen -> utterance_anliegen


}
subgraph cluster_to_agent {
    label = "Übergang zum Agenten"
    color = blue
    intent_anliegen_agent -> prompt_connect_agent
    intent_vnr_agent -> prompt_connect_agent
    intent_anliegen_xx -> prompt_anliegen_success
    logic_zweitversuch_anliegen -> prompt_connect_agent [label="ja"]
    prompt_anliegen_success -> end

}

}






